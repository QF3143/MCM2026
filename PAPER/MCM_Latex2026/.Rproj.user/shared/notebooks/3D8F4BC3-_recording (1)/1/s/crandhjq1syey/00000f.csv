"0","#| echo: false"
"0","library(gt)"
"0","df_metro_longer <- gt::metro |>"
"0","  dplyr::select(name, passengers, lines) |>"
"0","  dplyr::slice(1:10) |>"
"0","  tidyr::separate_longer_delim("
"0","    cols = lines,"
"0","    delim = ', '"
"0","  )"
"0",""
"0","create_line_badge <- function(line) {"
"0","  color_bg_dict <- c("
"0","    '1' = '#FFCE00',"
"0","    '2' = '#0064B0',"
"0","    '3' = '#9F9825',"
"0","    '3bis' = '#98D4E2',"
"0","    '4' = '#C04191',"
"0","    '5' = '#F28E42',"
"0","    '6' = '#83C491',"
"0","    '7' = '#F3A4BA',"
"0","    '7bis' = '#83C491',"
"0","    '8' = '#CEADD2',"
"0","    '9' = '#D5C900',"
"0","    '10' = '#E3B32A',"
"0","    '11' = '#8D5E2A',"
"0","    '12' = '#00814F',"
"0","    '13' = '#98D4E2',"
"0","    '14' = '#662483'"
"0","  )"
"0","  lines_color_fg_white <- c('2', '3', '4', '11', '12', '14')"
"0","  color_text <- if (line %in% lines_color_fg_white) ""#ffffff"" else ""#000000"""
"0",""
"0","  width_px <- 25"
"0","  htmltools::span("
"0","    htmltools::span("
"0","      line,"
"0","      style = htmltools::css(margin = 'auto')"
"0","    ),"
"0","    'typst:fill' = glue::glue('rgb(""{color_bg_dict[line]}"")'),"
"0","    'typst:text:fill' = glue::glue('rgb(""{color_text}"")'),"
"0","    style = htmltools::css("
"0","      display = 'inline-flex',"
"0","      width = paste0(width_px, 'px'),"
"0","      height = paste0(width_px, 'px'),"
"0","      background = color_bg_dict[line],"
"0","      color = color_text,"
"0","      border_radius = '100%'"
"0","    ),"
"0","    class = 'my-box'"
"0","  ) |>"
"0","    as.character()"
"0","}"
"0",""
"0","df_metro_longer |>"
"0","  dplyr::mutate(lines = purrr::map_chr(lines, create_line_badge)) |>"
"0","  dplyr::summarise("
"0","    lines = paste0(lines, collapse = ' '),"
"0","    .by = c(name, passengers)"
"0","  ) |>"
"0","  gt() |>"
"0","  fmt_number(columns = passengers, decimals = 0) |>"
"0","  fmt_markdown(columns = lines) |>"
"0","  data_color("
"0","    columns = passengers,"
"0","    method = ""numeric"","
"0","    palette = c('white', ""#0064B0""),"
"0","    domain = c(0, max(df_metro_longer$passengers))"
"0","  )"
